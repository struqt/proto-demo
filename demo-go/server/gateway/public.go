package gateway

import (
	"context"
	"github.com/golang/glog"
	"github.com/struqt/proto-demo/demo-go/server"
)

// Start
// Gateway is a reverse-proxy implementation whose HTTP handler is generated by grpc-gateway.
func Start(listen string) {
	defer glog.Flush()
	ctx := context.Background()
	opts := options{
		Addr:       listen,
		OpenAPIDir: server.OpenApiDir(),
		GRPCServer: endpoint{Network: server.Network(), Addr: server.Address()},
	}
	if err := run(ctx, opts); err != nil {
		glog.Fatal(err)
	}
	// curl -s 127.0.0.1:8080/demo/v3/echo --data '{"value":[{},[],false,null,0.5,"hello"]}' | jq
}
